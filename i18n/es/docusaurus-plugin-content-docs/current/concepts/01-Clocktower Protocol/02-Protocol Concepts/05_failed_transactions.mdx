---
id: failed_transactions
title: Transacciones Fallidas
sidebar_position: 5
---

# Transacciones Fallidas

### Razones del fallo

En una configuración abierta como suscripciones donde las transacciones se programan indefinidamente, ocurrirán situaciones donde un suscriptor falla. Esto puede ocurrir por dos razones:

- No hay suficiente aprobación
- No hay suficientes fondos

Por lo tanto, cuando la función del llamador hace su verificación periódica de transacciones programadas, también verifica si el suscriptor tiene suficiente aprobación y fondos.

Para evitar ataques al contrato, el protocolo debe crear gastos soportados por el suscriptor que hagan que el fallo sea lo suficientemente costoso para que incluso un usuario malicioso quiera evitar fallar.

Veamos cómo funciona esto basado en diferentes situaciones.

### Problemas

#### Revocación

Si el suscriptor ha revocado su aprobación para que Clocktower mueva fondos de su cuenta, la transacción fallará.

Cuando una suscripción falla por falta de aprobación, se deben hacer dos cosas:

- El suscriptor debe ser dado de baja por el llamador.
- La mayoría del [saldo de tarifas](fees#caller-fee-reserve) debe ser reembolsado al Proveedor con una cantidad menor yendo al llamador.

Pero ¿por qué es esto necesario?

#### Darse de baja

- Aunque el contrato ya no tiene aprobación para remitir fondos, el suscriptor aún está suscrito a la suscripción. Entonces, si la aprobación continúa siendo revocada, la suscripción fallará cada ciclo creando costos interminables para el llamador sin compensación.

- Dado que es más barato en términos de gas para el suscriptor revocar la aprobación que cancelar la suscripción, los suscriptores elegirán revocar la aprobación como método de darse de baja.

Si bien hay razones normales para revocar accidentalmente la aprobación, las dos condiciones anteriores requieren que el usuario deba ser dado de baja de la suscripción automáticamente por el llamador al fallar. Si el suscriptor revocó la aprobación por error, ahora necesitarán volver a suscribirse costando gas adicional.

#### Vectores de ataque

Hay situaciones donde un suscriptor malicioso fallaría intencionalmente.

#### Ataques DOS y Griefing

Un suscriptor podría fallar intencionalmente para crear costos de gas no reembolsados para el llamador. Esta situación de pérdida de dinero podría crear demasiadas pérdidas para el llamador haciéndolo antieconómico y por lo tanto deteniendo el contrato de incrementar a través del tiempo.

Pero al dar suficiente del saldo de tarifas perdido para compensar los costos de gas en el fallo, estas pérdidas se mitigan. Pero ¿por qué no dar TODO el saldo perdido al llamador?

#### Ataque de Freeloader

Otro ataque involucra a un suscriptor malicioso siendo tanto suscriptor como llamador mientras falla intencionalmente. Si al llamador se le reembolsara todo el [saldo de tarifas](fees#caller-fee-reserve) perdido, entonces podrían obtener un ciclo gratuito de bienes o servicios del creador de la suscripción ya que se estarían pagando a sí mismos como llamador. Para mitigar esto, la mayoría del saldo de tarifas debe ser reembolsado al proveedor para pagar por bienes o servicios prestados dentro del período de tiempo y una porción menor reembolsada al llamador para pagar los costos de gas.

Dado que el suscriptor ahora perdería constantemente fondos, esto mitiga el ataque anterior.

#### Otros vectores

Si surge otro vector, también hemos dado al creador de la suscripción la capacidad de eliminar usuarios de su lista de suscriptores con su propio método distintivo.

Arriba hemos mencionado usar un saldo de tarifas para pagar al llamador y mitigar ataques. Pero ¿cómo funciona esto realmente? Lo revisamos en la siguiente sección. 




